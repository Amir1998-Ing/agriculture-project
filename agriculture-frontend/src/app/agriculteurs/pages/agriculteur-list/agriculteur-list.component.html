<div class="container-fluid py-4">
  <!-- En-tête -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-0">
        <i class="fas fa-user-farmer text-primary me-2"></i>
        Liste des agriculteurs
      </h1>
      <p class="text-muted mb-0">Gérez les agriculteurs de votre plateforme</p>
    </div>
    <div>
      <a routerLink="/agriculteurs/create" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>
        Nouvel agriculteur
      </a>
    </div>
  </div>

  <!-- Barre de recherche et filtres -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              placeholder="Rechercher un agriculteur..."
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
            >
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" (change)="itemsPerPage = $any($event.target).value">
            <option [value]="10">10 par page</option>
            <option [value]="25">25 par page</option>
            <option [value]="50">50 par page</option>
          </select>
        </div>
        <div class="col-md-3 text-end">
          <span class="text-muted">
            {{ totalItems }} agriculteur{{ totalItems > 1 ? 's' : '' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div class="alert alert-danger" *ngIf="error" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-2">Chargement des agriculteurs...</p>
  </div>

  <!-- Tableau des agriculteurs -->
  <div *ngIf="!loading" class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>Téléphone</th>
              <th>Rôle</th>
              <th>Date d'inscription</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let agriculteur of paginatedAgriculteurs">
              <td class="fw-bold">#{{ agriculteur.id }}</td>
              <td>
                <strong>{{ agriculteur.nom }}</strong>
              </td>
              <td>
                <a href="mailto:{{ agriculteur.email }}" class="text-decoration-none">
                  {{ agriculteur.email }}
                </a>
              </td>
              <td>{{ agriculteur.telephone || 'Non renseigné' }}</td>
              <td>
                <span class="badge" [ngClass]="getRoleBadgeClass(agriculteur.role)">
                  {{ getRoleLabel(agriculteur.role) }}
                </span>
              </td>
              <td>
                {{ agriculteur.dateInscription | date:'dd/MM/yyyy' }}
              </td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <a 
                    [routerLink]="['/agriculteurs/view', agriculteur.id]" 
                    class="btn btn-outline-primary"
                    title="Voir"
                  >
                    <i class="fas fa-eye"></i>
                  </a>
                  <a 
                    [routerLink]="['/agriculteurs/edit', agriculteur.id]" 
                    class="btn btn-outline-warning"
                    title="Modifier"
                  >
                    <i class="fas fa-edit"></i>
                  </a>
                  <button 
                    type="button" 
                    class="btn btn-outline-danger"
                    (click)="deleteAgriculteur(agriculteur.id)"
                    title="Supprimer"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            
            <!-- Message si aucun résultat -->
            <tr *ngIf="filteredAgriculteurs.length === 0">
              <td colspan="7" class="text-center py-4">
                <div class="text-muted">
                  <i class="fas fa-inbox fa-2x mb-3"></i>
                  <p class="mb-0">Aucun agriculteur trouvé</p>
                  <small *ngIf="searchTerm">Essayez avec d'autres termes de recherche</small>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="d-flex justify-content-between align-items-center mt-4">
    <div class="text-muted">
      Page {{ currentPage }} sur {{ totalPages }}
    </div>
    <nav>
      <ul class="pagination mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="changePage(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
          </button>
        </li>
        
        <li *ngFor="let page of [].constructor(totalPages); let i = index" 
            class="page-item" 
            [class.active]="currentPage === i + 1">
          <button class="page-link" (click)="changePage(i + 1)">
            {{ i + 1 }}
          </button>
        </li>
        
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="changePage(currentPage + 1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Statistiques -->
  <div class="row mt-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-0">Total</h6>
              <h3 class="mb-0">{{ totalItems }}</h3>
            </div>
            <i class="fas fa-users fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-0">Agriculteurs</h6>
              <h3 class="mb-0">{{ agriculteurCount }}</h3>
            </div>
            <i class="fas fa-tractor fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-0">Administrateurs</h6>
              <h3 class="mb-0">{{ adminCount }}</h3>
            </div>
            <i class="fas fa-user-shield fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-0">Superviseurs</h6>
              <h3 class="mb-0">{{ superviseurCount }}</h3>
            </div>
            <i class="fas fa-chart-line fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>